COTS.25 = quantile(CC.mn, probs = 0.25),
COTS.75 = quantile(CC.mn, probs = 0.75))
# Best Model Average
res.plot.manta.av = res.plot.manta  %>% dplyr::filter(REP %in% BESTREPS & REEF_NAME %in% manta.reefs) %>%
group_by(REEF_NAME, Year, SECTOR, CROSS_SHELF) %>%
summarise(COTS.md = median(COTS.mn),
COTS.25 = quantile(COTS.mn, probs = 0.25),
COTS.75 = quantile(COTS.mn, probs = 0.75),
CC.md =  median(CC.mn),
COTS.25 = quantile(CC.mn, probs = 0.25),
COTS.75 = quantile(CC.mn, probs = 0.75))
loadPackages()
# Best Model Average
res.plot.manta.av = res.plot.manta  %>% dplyr::filter(REP %in% BESTREPS & REEF_NAME %in% manta.reefs) %>%
group_by(REEF_NAME, Year, SECTOR, CROSS_SHELF) %>%
summarise(COTS.md = median(COTS.mn),
COTS.25 = quantile(COTS.mn, probs = 0.25),
COTS.75 = quantile(COTS.mn, probs = 0.75),
CC.md =  median(CC.mn),
COTS.25 = quantile(CC.mn, probs = 0.25),
COTS.75 = quantile(CC.mn, probs = 0.75))
data.manta.valid.av = data.manta %>% filter(REEF_NAME.y %in% manta.reefs & REPORT_YEAR > 1995) %>%
mutate(REEF_NAME = REEF_NAME.y,
Year = REPORT_YEAR - 1) %>%
inner_join(res.plot.manta.av)
# Best Model Average
res.plot.manta.av = res.plot.manta  %>% dplyr::filter(REP %in% BESTREPS & REEF_NAME %in% manta.reefs) %>%
group_by(REEF_NAME, Year, SECTOR, CROSS_SHELF) %>%
summarise(COTS.md = median(COTS.mn),
COTS.25 = quantile(COTS.mn, probs = 0.25),
COTS.75 = quantile(COTS.mn, probs = 0.75),
CC.md =  median(CC.mn),
CC.25 = quantile(CC.mn, probs = 0.25),
CC.75 = quantile(CC.mn, probs = 0.75))
data.manta.valid.av = data.manta %>% filter(REEF_NAME.y %in% manta.reefs & REPORT_YEAR > 1995) %>%
mutate(REEF_NAME = REEF_NAME.y,
Year = REPORT_YEAR - 1) %>%
inner_join(res.plot.manta.av)
manta.reefs
# Best Model Average
res.plot.manta.av = res.plot.manta  %>% dplyr::filter(REP %in% BESTREPS & REEF_NAME %in% manta.reefs) %>%
group_by(REEF_NAME, Year, SECTOR, CROSS_SHELF) %>%
summarise(COTS.md = median(COTS.mn),
COTS.25 = quantile(COTS.mn, probs = 0.25),
COTS.75 = quantile(COTS.mn, probs = 0.75),
CC.md =  median(CC.mn),
CC.25 = quantile(CC.mn, probs = 0.25),
CC.75 = quantile(CC.mn, probs = 0.75))
View(res.plot.manta)
# Best Model Average
res.plot.manta.av = res.plot.manta  %>% dplyr::filter(REP %in% BESTREPS & REEF_NAME %in% manta.reefs) %>%
dplyr::group_by(REEF_NAME, Year, SECTOR, CROSS_SHELF) #%>%
# Best Model Average
res.plot.manta.av = res.plot.manta  %>% dplyr::filter(REP %in% BESTREPS & REEF_NAME %in% manta.reefs) %>%
dplyr::group_by(REEF_NAME, Year, SECTOR, CROSS_SHELF) %>%
dplyr::summarise(COTS.md = median(COTS.mn),
COTS.25 = quantile(COTS.mn, probs = 0.25),
COTS.75 = quantile(COTS.mn, probs = 0.75),
CC.md =  median(CC.mn),
CC.25 = quantile(CC.mn, probs = 0.25),
CC.75 = quantile(CC.mn, probs = 0.75))
data.manta.valid.av = data.manta %>% filter(REEF_NAME.y %in% manta.reefs & REPORT_YEAR > 1995) %>%
mutate(REEF_NAME = REEF_NAME.y,
Year = REPORT_YEAR - 1) %>%
inner_join(res.plot.manta.av)
GG.COTS.AV =
GG.COTS.AV
ggsave("Results/Figures/COTS.tiff",GG.COTS.AV, device="tiff", width=14, height=8, dpi = 300)
ggplot(data.manta.valid.av %>% filter(REP %in% BESTREPS), aes(x=Year, y=COTS.md)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line() +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75, fill=factor(REP)),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y")
GG.COTS.AV = ggplot(data.manta.valid.av, aes(x=Year, y=COTS.md)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line() +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75, fill=factor(REP)),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y")
GG.COTS.AV
GG.COTS.AV = ggplot(data.manta.valid.av, aes(x=Year, y=COTS.md)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line() +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y")
GG.COTS.AV
ggplot(data.manta.valid.av, aes(x=Year, y=COTS.md)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line() +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75),alpha=0.2) +
facet_grid(SECTOR~REEF_NAME,scales = "free_y")
View(MPE)
BESTREPS.T = unique(MPE[MPE$SECTOR=="TO",][order(MPE$MPE.COTS.NOZERO.ALL)[1:50],"REP"])
BESTREPS.T = unique(MPE[MPE$SECTOR=="TO",][order(MPE$MPE.COTS.NOZERO)[1:50],"REP"])
MPE[MPE$SECTOR=="TO",]
BESTREPS.T = unique(MPE[MPE$SECTOR=="TO",][order(MPE$MPE.COTS.NOZERO)[1:50],"REP"])
BESTREPS.T
MPE[MPE$SECTOR=="TO",][order(MPE$MPE.COTS.NOZERO)[1:10],"REP"]
MPE.T[order(MPE.T$MPE.COTS.NOZERO)[1:10],"REP"]
MPE.T = MPE[MPE$SECTOR=="TO",]
MPE.T[order(MPE.T$MPE.COTS.NOZERO)[1:10],"REP"]
BESTREPS.T = MPE.T[order(MPE.T$MPE.COTS.NOZERO)[1:10],"REP"]
BESTPARAMS.T = masterDF[BESTREPS.T,]
ggplot(data.manta.valid %>% filter(REP %in% .T & REEF_NAME %in% manta.reefs), aes(x=Year, y=COTS.mn)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line(aes(colour=as.factor(REP))) +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75, fill=factor(REP)),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y")
GG.COTS.T = ggplot(data.manta.valid %>% filter(REP %in% BESTREPS.T & REEF_NAME %in% manta.reefs), aes(x=Year, y=COTS.mn)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line(aes(colour=as.factor(REP))) +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75, fill=factor(REP)),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y")
GG.COTS.T
ggplot(data.manta.valid %>%
filter(REEF_NAME %in% c("Chicken Reef (18-086)","John Brewer Reef (18-075)", "Rib Reef (18-032)")),
aes(x=Year, y=COTS.mn)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line(aes(colour=as.factor(REP))) +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75, fill=factor(REP)),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y")
ggplot(data.manta.valid %>%
filter(REEF_NAME %in% c("Chicken Reef (18-086)","John Brewer Reef (18-075)", "Rib Reef (18-032)")),
aes(x=Year, y=COTS.mn)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line(aes(colour=as.factor(REP))) +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75, fill=factor(REP)),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y") + theme(legend.position = "none")
SECTORS
j=8
# browser()
manta.i = dplyr::filter(data.manta.valid, REP==i & SECTOR == SECTORS[j])
View(manta.i)
lm = lm(COTS.mn~MEAN_COTS, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[-manta.i$MEAN_COTS==0,])
summary(lm)$r.squared  ## R2 = 0.637
data=manta.i[-manta.i$MEAN_COTS==0,]
View(data)
manta.i$MEAN_COTS==0
-manta.i$MEAN_COTS==0
data=manta.i[!manta.i$MEAN_COTS==0,]
View(data)
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0,])
summary(lm)$r.squared  ## R2 = 0.637
#Compute validation table at sector level
for (i in 1:NREPS) {
manta.i = dplyr::filter(data.manta.valid, REP==i)
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.CC.ALL"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
lm = lm(COTS.mn~MEAN_COTS, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.ALL"] = mean(abs(summary(lm)$residuals))
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.NOZERO.ALL"] = mean(abs(summary(lm)$residuals))
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0 & manta.i$Year>2007,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.POST08.ALL"] = mean(abs(summary(lm)$residuals)) ##
for (j in 1:length(SECTORS)) {
# browser()
manta.i = dplyr::filter(data.manta.valid, REP==i & SECTOR == SECTORS[j])
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.CC"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
lm = lm(COTS.mn~MEAN_COTS, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS"] = mean(abs(summary(lm)$residuals)) ##
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.NOZERO"] = mean(abs(summary(lm)$residuals)) ##
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0 & manta.i$Year>2007,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.POST08"] = mean(abs(summary(lm)$residuals)) ##
}
}
#Compute validation table at sector level
for (i in 1:NREPS) {
print(i)
manta.i = dplyr::filter(data.manta.valid, REP==i)
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.CC.ALL"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
lm = lm(COTS.mn~MEAN_COTS, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.ALL"] = mean(abs(summary(lm)$residuals))
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.NOZERO.ALL"] = mean(abs(summary(lm)$residuals))
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0 & manta.i$Year>2007,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.POST08.ALL"] = mean(abs(summary(lm)$residuals)) ##
for (j in 1:length(SECTORS)) {
# browser()
print(j)
manta.i = dplyr::filter(data.manta.valid, REP==i & SECTOR == SECTORS[j])
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.CC"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
lm = lm(COTS.mn~MEAN_COTS, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS"] = mean(abs(summary(lm)$residuals)) ##
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.NOZERO"] = mean(abs(summary(lm)$residuals)) ##
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0 & manta.i$Year>2007,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.POST08"] = mean(abs(summary(lm)$residuals)) ##
}
}
j=5
SECTORS[j]
manta.i = dplyr::filter(data.manta.valid, REP==i & SECTOR == SECTORS[j])
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.CC"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
lm = lm(COTS.mn~MEAN_COTS, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS"] = mean(abs(summary(lm)$residuals)) ##
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.NOZERO"] = mean(abs(summary(lm)$residuals)) ##
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0 & manta.i$Year>2007,])
data=manta.i[!manta.i$MEAN_COTS==0 & manta.i$Year>2007,]
[!manta.i$MEAN_COTS==0 & manta.i$Year>2004,]
data=manta.i[!manta.i$MEAN_COTS==0 & manta.i$Year>2004,]
#Compute validation table at sector level
for (i in 1:NREPS) {
print(i)
manta.i = dplyr::filter(data.manta.valid, REP==i)
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.CC.ALL"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
lm = lm(COTS.mn~MEAN_COTS, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.ALL"] = mean(abs(summary(lm)$residuals))
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.NOZERO.ALL"] = mean(abs(summary(lm)$residuals))
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0 & manta.i$Year>2007,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.POST08.ALL"] = mean(abs(summary(lm)$residuals)) ##
for (j in 1:length(SECTORS)) {
# browser()
print(j)
manta.i = dplyr::filter(data.manta.valid, REP==i & SECTOR == SECTORS[j])
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.CC"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
lm = lm(COTS.mn~MEAN_COTS, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS"] = mean(abs(summary(lm)$residuals)) ##
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.NOZERO"] = mean(abs(summary(lm)$residuals)) ##
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0 & manta.i$Year>2004,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.POST08"] = mean(abs(summary(lm)$residuals)) ##
}
}
BESTREPS = unique(MPE[order(MPE$MPE.COTS.NOZERO.ALL)[1:50],"REP"])
BESTPARAMS = masterDF[BESTREPS,]
MPE.T = MPE[MPE$SECTOR=="TO",]
BESTREPS.T = MPE.T[order(MPE.T$MPE.COTS.NOZERO)[1:10],"REP"]
BESTPARAMS.T = masterDF[BESTREPS.T,]
GG.COTS.T = ggplot(data.manta.valid %>% filter(REP %in% BESTREPS.T & REEF_NAME %in% manta.reefs), aes(x=Year, y=COTS.mn)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line(aes(colour=as.factor(REP))) +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75, fill=factor(REP)),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y")
GG.COTS.T
BESTREPS.T
ggplot(data.manta.valid %>%
filter(REP %in% BESTREPS.T & REEF_NAME %in% c("Chicken Reef (18-086)","John Brewer Reef (18-075)", "Rib Reef (18-032)")),
aes(x=Year, y=COTS.mn)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line(aes(colour=as.factor(REP))) +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75, fill=factor(REP)),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y") + theme(legend.position = "none")
manta.i = dplyr::filter(data.manta.valid, REP==i & SECTOR == SECTORS[j])
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0,])
summary(lm)$r.squared  ## R2 = 0.637
ggplot(manta.i, aes(x=MEAN_COTS, y=COTS.mn)) + geom_smooth(method = "lm")
ggplot(manta.i, aes(x=MEAN_COTS, y=COTS.mn)) + geom_point()
plot(plot.new(lm$fitted.values))
j=8
SECTORS[j]
manta.i = dplyr::filter(data.manta.valid, REP==i & SECTOR == SECTORS[j])
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[!manta.i$MEAN_COTS==0,])
summary(lm)$r.squared  ## R2 = 0.637
ggplot(manta.i, aes(x=MEAN_COTS, y=COTS.mn)) + geom_point() +ylim=
BESTREPS = unique(MPE[order(MPE$MPE.COTS.NOZERO.ALL)[1:50],"REP"])
ggplot(manta.i, aes(x=MEAN_COTS, y=COTS.mn)) + geom_point()
ggplot(manta.i[!manta.i$MEAN_COTS==0,], aes(x=MEAN_COTS, y=COTS.mn)) + geom_point()
ggplot(manta.i[!manta.i$MEAN_COTS==0,], aes(x=sqrt(MEAN_COTS), y=sqrt(COTS.mn))) + geom_point()
ggplot(manta.i[!manta.i$MEAN_COTS==0,], aes(x=sqrt(MEAN_COTS), y=sqrt(COTS.mn))) + geom_point() +
geom_smooth(method="lm")
ggplot(manta.i[manta.i$MEAN_COTS>0.2,], aes(x=sqrt(MEAN_COTS), y=sqrt(COTS.mn))) + geom_point() +
geom_smooth(method="lm")
lm$coefficients
m$coefficients[2]
lm$coefficients[2]
MPE = data.frame(SECTOR= rep(SECTORS, each=NREPS),
REP = 1:NREPS,
MPE.CC = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.CC.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.CC.ALL = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.CC.ALL.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.ALL = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.ALL.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.NOZERO = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.NOZERO.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.NOZERO.ALL = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.NOZERO.ALL.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.POST08 = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.POST08.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.POST08.ALL = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.POST08.ALL.c = vector(mode = "numeric", NREPS*length(SECTORS)))
in
for (j in 1:length(SECTORS)) {
# browser()
print(j)
manta.i = dplyr::filter(data.manta.valid, REP==i & SECTOR == SECTORS[j])
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.CC"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.CC.c"] = lm$coefficients[2]
lm = lm(COTS.mn~MEAN_COTS, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS"] = mean(abs(summary(lm)$residuals)) ##
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.c"] = lm$coefficients[2]
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[manta.i$MEAN_COTS>0.11,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.NOZERO"] = mean(abs(summary(lm)$residuals)) ##
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.NOZERO.c"] = lm$coefficients[2]
lm = lm(COTS.mn~MEAN_COTS, data=manta.i[manta.i$MEAN_COTS>0.11 & manta.i$Year>2004,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.POST08"] = mean(abs(summary(lm)$residuals)) ##
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.POST08.c"] = lm$coefficients[2]
}
nrow(manta.i[manta.i$MEAN_COTS>0.11,])
sqrt(0)
MPE = data.frame(SECTOR= rep(SECTORS, each=NREPS),
REP = 1:NREPS,
MPE.CC = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.CC.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.CC.ALL = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.CC.ALL.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.ALL = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.ALL.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.NOZERO = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.NOZERO.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.NOZERO.ALL = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.NOZERO.ALL.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.POST08 = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.POST08.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.POST08.ALL = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.POST08.ALL.c = vector(mode = "numeric", NREPS*length(SECTORS)))
#Compute validation table at sector level
for (i in 1:NREPS) {
print(i)
manta.i = dplyr::filter(data.manta.valid, REP==i)
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.CC.ALL"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
MPE[MPE$REP==i,"MPE.CC.ALL.c"] = lm$coefficients[2]
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.ALL"] = mean(abs(summary(lm)$residuals))
MPE[MPE$REP==i,"MPE.COTS.ALL.c"] = lm$coefficients[2]
if (nrow(manta.i[manta.i$MEAN_COTS>0.11,])>0) {
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i[manta.i$MEAN_COTS>0.11,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.NOZERO.ALL"] = mean(abs(summary(lm)$residuals))
MPE[MPE$REP==i,"MPE.COTS.NOZERO.ALL.c"] = lm$coefficients[2]
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i[manta.i$MEAN_COTS>0.11 & manta.i$Year>2004,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.POST08.ALL"] = mean(abs(summary(lm)$residuals))
MPE[MPE$REP==i,"MPE.COTS.POST08.ALL.c"] = lm$coefficients[2]##
}
for (j in 1:length(SECTORS)) {
# browser()
print(j)
manta.i = dplyr::filter(data.manta.valid, REP==i & SECTOR == SECTORS[j])
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.CC"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.CC.c"] = lm$coefficients[2]
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS"] = mean(abs(summary(lm)$residuals)) ##
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.c"] = lm$coefficients[2]
if (nrow(manta.i[manta.i$MEAN_COTS>0.11,])>0) {
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i[manta.i$MEAN_COTS>0.11,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.NOZERO"] = mean(abs(summary(lm)$residuals)) ##
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.NOZERO.c"] = lm$coefficients[2]
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i[manta.i$MEAN_COTS>0.11 & manta.i$Year>2004,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.POST08"] = mean(abs(summary(lm)$residuals)) ##
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.POST08.c"] = lm$coefficients[2]
}
}
}
i
j
manta.i = dplyr::filter(data.manta.valid, REP==i & SECTOR == SECTORS[j])
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.CC"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.CC.c"] = lm$coefficients[2]
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS"] = mean(abs(summary(lm)$residuals)) ##
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.c"] = lm$coefficients[2]
nrow(manta.i[manta.i$MEAN_COTS>0.11,])
nrow(manta.i[manta.i$MEAN_COTS>0.11,])>0
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i[manta.i$MEAN_COTS>0.11,])
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i[manta.i$MEAN_COTS>0.11 & manta.i$Year>2004,])
MPE = data.frame(SECTOR= rep(SECTORS, each=NREPS),
REP = 1:NREPS,
MPE.CC = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.CC.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.CC.ALL = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.CC.ALL.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.ALL = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.ALL.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.NOZERO = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.NOZERO.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.NOZERO.ALL = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.NOZERO.ALL.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.POST08 = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.POST08.c = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.POST08.ALL = vector(mode = "numeric", NREPS*length(SECTORS)),
MPE.COTS.POST08.ALL.c = vector(mode = "numeric", NREPS*length(SECTORS)))
#Compute validation table at sector level
for (i in 1:NREPS) {
print(i)
manta.i = dplyr::filter(data.manta.valid, REP==i)
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.CC.ALL"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
MPE[MPE$REP==i,"MPE.CC.ALL.c"] = lm$coefficients[2]
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.ALL"] = mean(abs(summary(lm)$residuals))
MPE[MPE$REP==i,"MPE.COTS.ALL.c"] = lm$coefficients[2]
if (nrow(manta.i[manta.i$MEAN_COTS>0.11,])>0) {
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i[manta.i$MEAN_COTS>0.11,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$REP==i,"MPE.COTS.NOZERO.ALL"] = mean(abs(summary(lm)$residuals))
MPE[MPE$REP==i,"MPE.COTS.NOZERO.ALL.c"] = lm$coefficients[2]
# lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i[manta.i$MEAN_COTS>0.11 & manta.i$Year>2004,])
# summary(lm)$r.squared  ## R2 = 0.637
# MPE[MPE$REP==i,"MPE.COTS.POST08.ALL"] = mean(abs(summary(lm)$residuals))
# MPE[MPE$REP==i,"MPE.COTS.POST08.ALL.c"] = lm$coefficients[2]##
}
for (j in 1:length(SECTORS)) {
# browser()
print(j)
manta.i = dplyr::filter(data.manta.valid, REP==i & SECTOR == SECTORS[j])
lm = lm(CC.mn~MEAN_LIVE.corr, data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.CC"] = mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.CC.c"] = lm$coefficients[2]
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i)
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS"] = mean(abs(summary(lm)$residuals)) ##
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.c"] = lm$coefficients[2]
if (nrow(manta.i[manta.i$MEAN_COTS>0.11,])>0) {
lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i[manta.i$MEAN_COTS>0.11,])
summary(lm)$r.squared  ## R2 = 0.637
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.NOZERO"] = mean(abs(summary(lm)$residuals)) ##
MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.NOZERO.c"] = lm$coefficients[2]
# lm = lm(sqrt(COTS.mn)~sqrt(MEAN_COTS), data=manta.i[manta.i$MEAN_COTS>0.11 & manta.i$Year>2004,])
# summary(lm)$r.squared  ## R2 = 0.637
# MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.POST08"] = mean(abs(summary(lm)$residuals)) ##
# MPE[MPE$SECTOR==SECTORS[j] & MPE$REP==i,"MPE.COTS.POST08.c"] = lm$coefficients[2]
}
}
}
View(MPE)
MPE.T = MPE[MPE$SECTOR=="TO",]
View(MPE.T)
BESTREPS.T = MPE.T[MPE.T$MPE.COTS.NOZERO.c>0.5 & MPE.T$MPE.COTS.NOZERO.c<1.5,"REP"]
BESTREPS.T
BESTPARAMS.T = masterDF[BESTREPS.T,]
ggplot(data.manta.valid %>%
filter(REP %in% BESTREPS.T & REEF_NAME %in% c("Chicken Reef (18-086)","John Brewer Reef (18-075)", "Rib Reef (18-032)")),
aes(x=Year, y=COTS.mn)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line(aes(colour=as.factor(REP))) +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75, fill=factor(REP)),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y") + theme(legend.position = "none")
ggplot(data.manta.valid %>%
filter(REP %in% BESTREPS.T & REEF_NAME %in% c("Chicken Reef (18-086)","John Brewer Reef (18-075)", "Rib Reef (18-032)")),
aes(x=Year, y=COTS.mn)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line(aes(colour=as.factor(REP))) +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75, fill=factor(REP)),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y") + ylim(c(0,10))
BESTREPS.T = MPE.T[MPE.T$MPE.COTS.NOZERO.c>0.5 & MPE.T$MPE.COTS.NOZERO.c<1.5 &
MPE.T$MPE.COTS.NOZERO<3.5 ,"REP"]
BESTREPS.T = MPE.T[MPE.T$MPE.COTS.NOZERO.c>0.5 & MPE.T$MPE.COTS.NOZERO.c<1.5 &
MPE.T$MPE.COTS.NOZERO<3 ,"REP"]
ggplot(data.manta.valid %>%
filter(REP %in% BESTREPS.T & REEF_NAME %in% c("Chicken Reef (18-086)","John Brewer Reef (18-075)", "Rib Reef (18-032)")),
aes(x=Year, y=COTS.mn)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line(aes(colour=as.factor(REP))) +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75, fill=factor(REP)),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y") + ylim(c(0,10))
BESTREPS.T = MPE.T[order(MPE.T$MPE.COTS.NOZERO.ALL)[1:5],"REP"]
ggplot(data.manta.valid %>%
filter(REP %in% BESTREPS.T & REEF_NAME %in% c("Chicken Reef (18-086)","John Brewer Reef (18-075)", "Rib Reef (18-032)")),
aes(x=Year, y=COTS.mn)) +
geom_point(aes(y=MEAN_COTS)) + geom_line(aes(x=Year, y=MEAN_COTS)) +
geom_line(aes(colour=as.factor(REP))) +  geom_ribbon(aes(ymin = COTS.25, ymax=COTS.75, fill=factor(REP)),alpha=0.2) +
facet_wrap(~SECTOR+REEF_NAME,scales = "free_y") + ylim(c(0,10))
