#             Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
#             Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
#             Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
COTS.Reef = as.data.frame(COTSMat) %>%
tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
dplyr::group_by(REEF_NAME, Year) %>%
dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
Med.COTS = median(COTS, na.rm = T),
Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
COTS.Cluster = as.data.frame(COTSMat) %>%
tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
dplyr::left_join(dplyr::select(data.grid, PIXEL_ID, bent.clust), by="PIXEL_ID") %>%
dplyr::group_by(bent.clust, Year) %>%
dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
Med.COTS = median(COTS, na.rm = T),
Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
COTS.GBR = as.data.frame(COTSMat) %>%
tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
dplyr::group_by(Year) %>%
dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
Med.COTS = median(COTS, na.rm = T),
Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
# Compute Statisctics against manta
return(list(CC.Reef, CC.Cluster, CC.GBR, COTS.Reef, COTS.Cluster, COTS.GBR))
}
DataHarvest.TEST = HarvestData(RESULTS_DIRECTORY)
CC.Reef = cbind(Results$REEF_NAME,as.data.frame(CoralMat))
HarvestData = function(RESULTS_DIRECTORY) {
setwd(RESULTS_DIRECTORY)
CoralMat = matrix(NA, nrow = (npops*NYEARS*NSEASONS), ncol = NREPS+3)
COTSMat = matrix(NA, nrow = (npops*NYEARS*NSEASONS), ncol = NREPS+3)
load("Sample_1.Rdata")
CoralMat[,1]=COTSMat[,1] = Results[, "PIXEL_ID"]
CoralMat[,2]=COTSMat[,2] = Results[, "Year"]
CoralMat[,3]=COTSMat[,3] = Results[, "Season"]
colnames(CoralMat) = c("PIXEL_ID", "Year", "Season", 1:NREPS)
colnames(COTSMat) = c("PIXEL_ID", "Year", "Season", 1:NREPS)
for (i in 1:NREPS){
load(sprintf("Sample_%s.Rdata", i))
CoralMat[,i+3] = Results[,"CoralCover"]
COTSMat[,i+3] = Results[,"COTSA"]
}
browser()
# CC.df = as.data.frame(CoralMat) %>%
#   tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4))
# CC.Pixel = as.data.frame(CoralMat) %>%
#   tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4)) %>%
#   dplyr::group_by(PIXEL_ID, Year) %>%
#   dplyr::summarise(Avg.CC = mean(CoralCover, na.rm = T),
#             Serr.CC = sd(CoralCover, na.rm = T)/sqrt(n()),
#             Med.CC = median(CoralCover, na.rm = T),
#             Min.CC = quantile(CoralCover, probs = 0.05, na.rm = T),
#             Max.CC = quantile(CoralCover, probs = 0.95, na.rm = T),
#             Q25.CC = quantile(CoralCover, probs = 0.25, na.rm = T),
#             Q75.CC = quantile(CoralCover, probs = 0.75, na.rm = T))
CC.Reef = cbind(Results$REEF_NAME,as.data.frame(CoralMat)) %>%
tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4)) %>%
dplyr::group_by(REEF_NAME, Year) %>%
dplyr::summarise(Avg.CC = mean(CoralCover, na.rm = T),
Serr.CC = sd(CoralCover, na.rm = T)/sqrt(n()),
Med.CC = median(CoralCover, na.rm = T),
Min.CC = quantile(CoralCover, probs = 0.05, na.rm = T),
Max.CC = quantile(CoralCover, probs = 0.95, na.rm = T),
Q25.CC = quantile(CoralCover, probs = 0.25, na.rm = T),
Q75.CC = quantile(CoralCover, probs = 0.75, na.rm = T))
CC.Cluster = as.data.frame(CoralMat) %>%
tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4)) %>%
dplyr::left_join(dplyr::select(data.grid, PIXEL_ID, bent.clust), by="PIXEL_ID") %>%
dplyr::group_by(bent.clust, Year) %>%
dplyr::summarise(Avg.CC = mean(CoralCover, na.rm = T),
Serr.CC = sd(CoralCover, na.rm = T)/sqrt(n()),
Med.CC = median(CoralCover, na.rm = T),
Min.CC = quantile(CoralCover, probs = 0.05, na.rm = T),
Max.CC = quantile(CoralCover, probs = 0.95, na.rm = T),
Q25.CC = quantile(CoralCover, probs = 0.25, na.rm = T),
Q75.CC = quantile(CoralCover, probs = 0.75, na.rm = T))
CC.GBR = as.data.frame(CoralMat) %>%
tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4)) %>%
dplyr::group_by(Year) %>%
dplyr::summarise(Avg.CC = mean(CoralCover, na.rm = T),
Serr.CC = sd(CoralCover, na.rm = T)/sqrt(n()),
Med.CC = median(CoralCover, na.rm = T),
Min.CC = quantile(CoralCover, probs = 0.05, na.rm = T),
Max.CC = quantile(CoralCover, probs = 0.95, na.rm = T),
Q25.CC = quantile(CoralCover, probs = 0.25, na.rm = T),
Q75.CC = quantile(CoralCover, probs = 0.75, na.rm = T))
# COTS.Pixel = as.data.frame(COTSMat) %>%
#   tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
#   dplyr::group_by(PIXEL_ID, Year) %>%
#   dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
#             Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
#             Med.COTS = median(COTS, na.rm = T),
#             Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
#             Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
#             Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
#             Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
COTS.Reef = as.data.frame(COTSMat) %>%
tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
dplyr::group_by(REEF_NAME, Year) %>%
dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
Med.COTS = median(COTS, na.rm = T),
Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
COTS.Cluster = as.data.frame(COTSMat) %>%
tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
dplyr::left_join(dplyr::select(data.grid, PIXEL_ID, bent.clust), by="PIXEL_ID") %>%
dplyr::group_by(bent.clust, Year) %>%
dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
Med.COTS = median(COTS, na.rm = T),
Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
COTS.GBR = as.data.frame(COTSMat) %>%
tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
dplyr::group_by(Year) %>%
dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
Med.COTS = median(COTS, na.rm = T),
Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
# Compute Statisctics against manta
return(list(CC.Reef, CC.Cluster, CC.GBR, COTS.Reef, COTS.Cluster, COTS.GBR))
}
DataHarvest.TEST = HarvestData(RESULTS_DIRECTORY)
dims(COTSMat)
dim(COTSMat)
CC.Reef = cbind(Results$REEF_NAME,as.data.frame(CoralMat))
View(CC.Reef)
HarvestData = function(RESULTS_DIRECTORY) {
setwd(RESULTS_DIRECTORY)
CoralMat = matrix(NA, nrow = (npops*NYEARS*NSEASONS), ncol = NREPS+3)
COTSMat = matrix(NA, nrow = (npops*NYEARS*NSEASONS), ncol = NREPS+3)
load("Sample_1.Rdata")
CoralMat[,1]=COTSMat[,1] = Results[, "PIXEL_ID"]
CoralMat[,2]=COTSMat[,2] = Results[, "Year"]
CoralMat[,3]=COTSMat[,3] = Results[, "Season"]
colnames(CoralMat) = c("PIXEL_ID", "Year", "Season", 1:NREPS)
colnames(COTSMat) = c("PIXEL_ID", "Year", "Season", 1:NREPS)
for (i in 1:NREPS){
load(sprintf("Sample_%s.Rdata", i))
CoralMat[,i+3] = Results[,"CoralCover"]
COTSMat[,i+3] = Results[,"COTSA"]
}
# browser()
# CC.df = as.data.frame(CoralMat) %>%
#   tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4))
# CC.Pixel = as.data.frame(CoralMat) %>%
#   tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4)) %>%
#   dplyr::group_by(PIXEL_ID, Year) %>%
#   dplyr::summarise(Avg.CC = mean(CoralCover, na.rm = T),
#             Serr.CC = sd(CoralCover, na.rm = T)/sqrt(n()),
#             Med.CC = median(CoralCover, na.rm = T),
#             Min.CC = quantile(CoralCover, probs = 0.05, na.rm = T),
#             Max.CC = quantile(CoralCover, probs = 0.95, na.rm = T),
#             Q25.CC = quantile(CoralCover, probs = 0.25, na.rm = T),
#             Q75.CC = quantile(CoralCover, probs = 0.75, na.rm = T))
CC.Reef = cbind("REEF_NAME" = Results$REEF_NAME, as.data.frame(CoralMat)) %>%
tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4)) %>%
dplyr::group_by(REEF_NAME, Year) %>%
dplyr::summarise(Avg.CC = mean(CoralCover, na.rm = T),
Serr.CC = sd(CoralCover, na.rm = T)/sqrt(n()),
Med.CC = median(CoralCover, na.rm = T),
Min.CC = quantile(CoralCover, probs = 0.05, na.rm = T),
Max.CC = quantile(CoralCover, probs = 0.95, na.rm = T),
Q25.CC = quantile(CoralCover, probs = 0.25, na.rm = T),
Q75.CC = quantile(CoralCover, probs = 0.75, na.rm = T))
CC.Cluster = cbind("REEF_NAME" = Results$REEF_NAME, as.data.frame(CoralMat)) %>%
tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4)) %>%
dplyr::left_join(dplyr::select(data.grid, PIXEL_ID, bent.clust), by="PIXEL_ID") %>%
dplyr::group_by(bent.clust, Year) %>%
dplyr::summarise(Avg.CC = mean(CoralCover, na.rm = T),
Serr.CC = sd(CoralCover, na.rm = T)/sqrt(n()),
Med.CC = median(CoralCover, na.rm = T),
Min.CC = quantile(CoralCover, probs = 0.05, na.rm = T),
Max.CC = quantile(CoralCover, probs = 0.95, na.rm = T),
Q25.CC = quantile(CoralCover, probs = 0.25, na.rm = T),
Q75.CC = quantile(CoralCover, probs = 0.75, na.rm = T))
CC.GBR = cbind("REEF_NAME" = Results$REEF_NAME,as.data.frame(CoralMat)) %>%
tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4)) %>%
dplyr::group_by(Year) %>%
dplyr::summarise(Avg.CC = mean(CoralCover, na.rm = T),
Serr.CC = sd(CoralCover, na.rm = T)/sqrt(n()),
Med.CC = median(CoralCover, na.rm = T),
Min.CC = quantile(CoralCover, probs = 0.05, na.rm = T),
Max.CC = quantile(CoralCover, probs = 0.95, na.rm = T),
Q25.CC = quantile(CoralCover, probs = 0.25, na.rm = T),
Q75.CC = quantile(CoralCover, probs = 0.75, na.rm = T))
# COTS.Pixel = as.data.frame(COTSMat) %>%
#   tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
#   dplyr::group_by(PIXEL_ID, Year) %>%
#   dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
#             Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
#             Med.COTS = median(COTS, na.rm = T),
#             Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
#             Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
#             Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
#             Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
COTS.Reef = cbind("REEF_NAME" = Results$REEF_NAME,as.data.frame(COTSMat)) %>%
tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
dplyr::group_by(REEF_NAME, Year) %>%
dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
Med.COTS = median(COTS, na.rm = T),
Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
COTS.Cluster = cbind("REEF_NAME" = Results$REEF_NAME,as.data.frame(COTSMat)) %>%
tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
dplyr::left_join(dplyr::select(data.grid, PIXEL_ID, bent.clust), by="PIXEL_ID") %>%
dplyr::group_by(bent.clust, Year) %>%
dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
Med.COTS = median(COTS, na.rm = T),
Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
COTS.GBR = cbind("REEF_NAME" = Results$REEF_NAME,as.data.frame(COTSMat)) %>%
tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
dplyr::group_by(Year) %>%
dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
Med.COTS = median(COTS, na.rm = T),
Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
# Compute Statisctics against manta
return(list(CC.Reef, CC.Cluster, CC.GBR, COTS.Reef, COTS.Cluster, COTS.GBR))
}
DataHarvest.TEST = HarvestData(RESULTS_DIRECTORY)
## Select manta reefs by FULLREEF_ID
data.manta <- subset(data.manta, REEF_LAT < (-14)) # Remove norternmost reefs (off the grid)
manta.recent <- data.manta[data.manta$REPORT_YEAR>1995,]
View(manta.recent)
reef10.ls <- names(table(manta.recent$FULLREEF_ID)[table(manta.recent$FULLREEF_ID)>9]) ## n=54 reefs with at least 10 years of data post 1995
reef.calib.ls <- reef10.ls[reef10.ls %in% data.reef$FULLREEF_ID]
reef.valid.ls <- reef10.ls[!(reef10.ls %in% data.reef$FULLREEF_ID)]
## Link to REEF_ID through data.manta.env and create lists of FID (REEF_ID)
obs.manta.tmp <- subset(data.manta, FULLREEF_ID %in% reef10.ls)
obs.manta <- merge.data.frame(obs.manta.tmp, data.manta.env[,c("FULLREEF_ID", "REEF_ID")])
obs.manta <- obs.manta[order(obs.manta$REEF_ID, obs.manta$REPORT_YEAR),]
View(obs.manta)
obs.fid <- unique(obs.manta$REEF_ID)[order(unique(obs.manta$REEF_ID))]
obs.calib <- obs.manta[obs.manta$FULLREEF_ID %in% reef.calib.ls & obs.manta$REEF_LAT < (-14),]
obs.valid <- obs.manta[obs.manta$FULLREEF_ID %in% reef.valid.ls & obs.manta$REEF_LAT < (-14),]
obs.calib.fid <- unique(obs.calib$REEF_ID)
obs.valid.fid <- unique(obs.valid$REEF_ID)
View(data.manta)
setwd(DATA_DIRECTORY)
data.manta = read.table("CoralModel/Manta.csv", header = TRUE, sep = ",")
data.manta.env = read.table("CoralModel/Manta_ENV.txt", header = TRUE, sep = "\t")
# Modelled Disturbance
data.bleaching = read.csv("Disturbance/Bleaching_data_98_02_16.csv", header = TRUE) %>%
dplyr::filter(REEF_NAME %in% ourreefs) %>% dplyr::mutate(REEF_NAME = factor(REEF_NAME))
data.COTS = read.csv("Disturbance/CoTS_data.csv", header = TRUE) %>%
dplyr::filter(REEF_NAME %in% ourreefs) %>% dplyr::mutate(REEF_NAME = factor(REEF_NAME))
data.storms =  read.csv("Disturbance/Cyclones_data.csv", header = TRUE) %>%
dplyr::filter(REEF_NAME %in% ourreefs) %>% dplyr::mutate(REEF_NAME = factor(REEF_NAME))
data.disease = read.table("CoralModel/Disturb_disease.txt", header = TRUE, sep = "\t")
# Environmental Data + BRT/MRT Predictions of Coral Growth Parameters
data.grid = read.table("CoralModel/XYZ_BRTpred_MRTpred_GG.csv", header = TRUE, sep = ",")
data.grid = data.grid[order(data.grid$LONG, data.grid$LAT),]; colnames(data.grid)[2:3] = c("lon", "lat")
data.grid = PopData %>% dplyr::inner_join(dplyr::select(data.grid, 2:3, 51:62), by=c("lon", "lat"))
data.reef <- read.table("CoralModel/MRT_reef_clust_Gompertz.txt", header = TRUE, sep = "\t")
View(data.reef)
View(data.manta)
View(data.manta.env)
data.manta$REEF_NAME_GBRMPA = gsub(data.manta$FULLREEF_ID, "S", "")
data.manta$REEF_NAME_GBRMPA = gsub("S","",data.manta$FULLREEF_ID)
data.manta$REEF_NAME_GBRMPA = gsub("s","",tolower(data.manta$FULLREEF_ID))
data.manta$REEF_NAME_GBRMPA = paste(substr(data.manta$REEF_NAME_GBRMPA,1,2), substr(data.manta$REEF_NAME_GBRMPA, 3 ,6), sep = "-")
data.manta = read.table("CoralModel/Manta.csv", header = TRUE, sep = ",")
data.manta$REEF_ID= gsub("s","",tolower(data.manta$FULLREEF_ID))
data.manta$REEF_ID = paste(substr(data.manta$REEF_ID,1,2), substr(data.manta$REEF_ID, 3 ,6), sep = "-")
unique(data.grid[,4:5])
data.manta = dplyr::left_join(data.manta, unique(data.grid[,4:5]), by="REEF_ID")
View(data.manta)
data.manta$REEF_ID = gsub("22-104","22-104a",data.manta$REEF_ID)
data.manta$REEF_ID = gsub("23-052","23-052a",data.manta$REEF_ID)
data.manta$REEF_ID = gsub("17-012a","17-012",data.manta$REEF_ID)
data.manta$REEF_ID = gsub("23-082","23-082a",data.manta$REEF_ID)
data.manta$REEF_ID = gsub("23-055","23-055a",data.manta$REEF_ID)
data.manta = read.table("CoralModel/Manta.csv", header = TRUE, sep = ",")
data.manta.env = read.table("CoralModel/Manta_ENV.txt", header = TRUE, sep = "\t")
data.manta$REEF_ID= gsub("s","",tolower(data.manta$FULLREEF_ID))
data.manta$REEF_ID = paste(substr(data.manta$REEF_ID,1,2), substr(data.manta$REEF_ID, 3 ,6), sep = "-")
data.manta$REEF_ID = gsub("22-104","22-104a",data.manta$REEF_ID)
data.manta$REEF_ID = gsub("23-052","23-052a",data.manta$REEF_ID)
data.manta$REEF_ID = gsub("17-012a","17-012",data.manta$REEF_ID)
data.manta$REEF_ID = gsub("23-082","23-082a",data.manta$REEF_ID)
data.manta$REEF_ID = gsub("23-055","23-055a",data.manta$REEF_ID)
data.manta = dplyr::left_join(data.manta, unique(data.grid[,4:5]), by="REEF_ID")
View(data.manta)
## Select manta reefs by FULLREEF_ID
data.manta <- subset(data.manta, REEF_LAT < (-14)) # Remove norternmost reefs (off the grid)
manta.recent <- data.manta[data.manta$REPORT_YEAR>1995,]
reef10.ls <- names(table(manta.recent$FULLREEF_ID)[table(manta.recent$FULLREEF_ID)>9]) ## n=54 reefs with at least 10 years of data post 1995
reef.calib.ls <- reef10.ls[reef10.ls %in% data.reef$FULLREEF_ID]
reef.valid.ls <- reef10.ls[!(reef10.ls %in% data.reef$FULLREEF_ID)]
## Link to REEF_ID through data.manta.env and create lists of FID (REEF_ID)
obs.manta.tmp <- subset(data.manta, FULLREEF_ID %in% reef10.ls)
obs.manta <- merge.data.frame(obs.manta.tmp, data.manta.env[,c("FULLREEF_ID", "REEF_ID")])
obs.manta <- obs.manta[order(obs.manta$REEF_ID, obs.manta$REPORT_YEAR),]
View(obs.manta)
## Select manta reefs by FULLREEF_ID
data.manta <- subset(data.manta, REEF_LAT < (-14)) # Remove norternmost reefs (off the grid)
manta.recent <- data.manta[data.manta$REPORT_YEAR>1995,]
reef10.ls <- names(table(manta.recent$FULLREEF_ID)[table(manta.recent$FULLREEF_ID)>9]) ## n=54 reefs with at least 10 years of data post 1995
reef.calib.ls <- reef10.ls[reef10.ls %in% data.reef$FULLREEF_ID]
reef.valid.ls <- reef10.ls[!(reef10.ls %in% data.reef$FULLREEF_ID)]
## Link to REEF_ID through data.manta.env and create lists of FID (REEF_ID)
obs.manta.tmp <- subset(data.manta, FULLREEF_ID %in% reef10.ls)
obs.manta <- merge.data.frame(obs.manta.tmp, data.manta.env[,c("FULLREEF_ID", "REEF_ID")])
data.manta.env = read.table("CoralModel/Manta_ENV.txt", header = TRUE, sep = "\t")
data.manta = read.table("CoralModel/Manta.csv", header = TRUE, sep = ",")
data.manta$REEF_ID= gsub("s","",tolower(data.manta$FULLREEF_ID))
data.manta$REEF_ID = paste(substr(data.manta$REEF_ID,1,2), substr(data.manta$REEF_ID, 3 ,6), sep = "-")
data.manta$REEF_ID = gsub("22-104","22-104a",data.manta$REEF_ID)
data.manta$REEF_ID = gsub("23-052","23-052a",data.manta$REEF_ID)
data.manta$REEF_ID = gsub("17-012a","17-012",data.manta$REEF_ID)
data.manta$REEF_ID = gsub("23-082","23-082a",data.manta$REEF_ID)
data.manta$REEF_ID = gsub("23-055","23-055a",data.manta$REEF_ID)
data.manta = dplyr::left_join(data.manta, unique(data.grid[,4:5]), by="REEF_ID")
# Modelled Disturbance
# obs.manta <- merge.data.frame(obs.manta.tmp, data.manta.env[,c("FULLREEF_ID", "REEF_ID")])
obs.manta <- obs.manta[order(obs.manta$REEF_ID, obs.manta$REPORT_YEAR),]
# obs.manta <- merge.data.frame(obs.manta.tmp, data.manta.env[,c("FULLREEF_ID", "REEF_ID")])
obs.manta <- obs.manta.tmp[order(obs.manta.tmp$REEF_ID, obs.manta.tmp$REPORT_YEAR),]
View(obs.manta)
obs.fid <- unique(obs.manta$REEF_ID)[order(unique(obs.manta$REEF_ID))]
obs.calib <- obs.manta[obs.manta$FULLREEF_ID %in% reef.calib.ls & obs.manta$REEF_LAT < (-14),]
obs.valid <- obs.manta[obs.manta$FULLREEF_ID %in% reef.valid.ls & obs.manta$REEF_LAT < (-14),]
obs.calib.fid <- unique(obs.calib$REEF_ID)
obs.valid.fid <- unique(obs.valid$REEF_ID)
obs.fid <- unique(obs.manta$REEF_NAME.y)[order(unique(obs.manta$REEF_NAME.y))]
obs.calib <- obs.manta[obs.manta$FULLREEF_ID %in% reef.calib.ls & obs.manta$REEF_LAT < (-14),]
obs.valid <- obs.manta[obs.manta$FULLREEF_ID %in% reef.valid.ls & obs.manta$REEF_LAT < (-14),]
obs.calib.fid <- unique(obs.calib$REEF_NAME.y)
obs.valid.fid <- unique(obs.valid$REEF_NAME.y)
## Select model predictions corresponding to CALIBRATION and VALIDATION reef sets
res.reef.fid <- DataHarvest.TEST[[1]]
res.calib.fid <- res.reef.fid[res.reef.fid %in% obs.calib.fid]
res.calib = dplyr::filter(res.reef.fid %in% obs.calib.fid)
res.calib = dplyr::filter(res.reef.fid, REEF_NAME %in% obs.calib.fid)
res.valib = dplyr::filter(res.reef.fid, REEF_NAME %in% obs.valib.fid)
res.valib = dplyr::filter(res.reef.fid, REEF_NAME %in% obs.valid.fid)
res.manta = dplyr::filter(res.reef.fid, REEF_NAME %in% obs.fid)
res.valid = dplyr::filter(res.reef.fid, REEF_NAME %in% obs.valid.fid)
obs.manta = obs.manta %>% select(-REEF_NAME.x) %>% rename_vars("REEF_NAME.y" = "REEF_NAME")
obs.manta = obs.manta %>% select(-REEF_NAME.x) #%>% rename_vars("REEF_NAME.y" = "REEF_NAME")
obs.manta = obs.manta %>% dplyr::select(-REEF_NAME.x) #%>% rename_vars("REEF_NAME.y" = "REEF_NAME")
# obs.manta <- merge.data.frame(obs.manta.tmp, data.manta.env[,c("FULLREEF_ID", "REEF_ID")])
obs.manta <- obs.manta.tmp[order(obs.manta.tmp$REEF_ID, obs.manta.tmp$REPORT_YEAR),]
obs.manta = obs.manta %>% dplyr::select(-REEF_NAME.x) %>% rename_vars("REEF_NAME.y" = "REEF_NAME")
obs.manta = obs.manta %>% dplyr::select(-REEF_NAME.x) %>% dplyr::rename_vars("REEF_NAME.y" = "REEF_NAME")
obs.manta = obs.manta %>% dplyr::select(-REEF_NAME.x) %>% dplyr::rename(REEF_NAME.y = REEF_NAME)
obs.manta = obs.manta %>% dplyr::select(-REEF_NAME.x) %>% dplyr::rename(REEF_NAME = REEF_NAME.y)
res.manta = dplyr::left_join(res.manta, dplyr::select(obs.manta,REEF_NAME, SAMPLE_DATE, REPORT_YEAR, MEAN_LIVE, MEAN_COTS, SE_COTS, TOWS),
by="REEF_NAME")
View(res.manta)
res.manta = dplyr::filter(res.reef.fid, REEF_NAME %in% obs.fid)
# obs.manta <- merge.data.frame(obs.manta.tmp, data.manta.env[,c("FULLREEF_ID", "REEF_ID")])
obs.manta <- obs.manta.tmp[order(obs.manta.tmp$REEF_ID, obs.manta.tmp$REPORT_YEAR),]
obs.manta = obs.manta %>% dplyr::select(-REEF_NAME.x) %>% dplyr::rename(REEF_NAME = REEF_NAME.y, YEAR = REPORT_YEAR)
# obs.manta <- merge.data.frame(obs.manta.tmp, data.manta.env[,c("FULLREEF_ID", "REEF_ID")])
obs.manta <- obs.manta.tmp[order(obs.manta.tmp$REEF_ID, obs.manta.tmp$REPORT_YEAR),]
obs.manta = obs.manta %>% dplyr::select(-REEF_NAME.x) %>% dplyr::rename(REEF_NAME = REEF_NAME.y, Year = REPORT_YEAR)
res.manta = dplyr::left_join(res.manta, dplyr::select(obs.manta,REEF_NAME, SAMPLE_DATE, REPORT_YEAR, MEAN_LIVE, MEAN_COTS, SE_COTS, TOWS),
by=c("REEF_NAME", "Year"))
res.manta = dplyr::left_join(res.manta, dplyr::select(obs.manta,REEF_NAME, SAMPLE_DATE, Year, MEAN_LIVE, MEAN_COTS, SE_COTS, TOWS),
by=c("REEF_NAME", "Year"))
View(res.manta)
#plot(pred.obs.all$pred, pred.obs.all$obs, xlim=c(10,70), ylim=c(10,70))
lm <- lm(Med.CC ~ MEAN_LIVE, data = res.manta)
summary(lm)$r.squared  ## R2 = 0.637
mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
#plot(pred.obs.all$pred, pred.obs.all$obs, xlim=c(10,70), ylim=c(10,70))
lm <- lm(Avg.CC ~ MEAN_LIVE, data = res.manta)
summary(lm)$r.squared  ## R2 = 0.637
mean(abs(summary(lm)$residuals)) ## Mean prediction error = 7.7 %
plot(res.manta$Avg.CC, res.manta~MEAN_LIVE)
plot(res.manta$Avg.CC, res.manta$MEAN_LIVE)
summary(lm)  ## R2 = 0.637
Reef = dplyr::inner_join(CC.Reef, COTS.Reef, by=c("REEF_NAME", "Year"))
HarvestData = function(RESULTS_DIRECTORY) {
setwd(RESULTS_DIRECTORY)
CoralMat = matrix(NA, nrow = (npops*NYEARS*NSEASONS), ncol = NREPS+3)
COTSMat = matrix(NA, nrow = (npops*NYEARS*NSEASONS), ncol = NREPS+3)
load("Sample_1.Rdata")
CoralMat[,1]=COTSMat[,1] = Results[, "PIXEL_ID"]
CoralMat[,2]=COTSMat[,2] = Results[, "Year"]
CoralMat[,3]=COTSMat[,3] = Results[, "Season"]
colnames(CoralMat) = c("PIXEL_ID", "Year", "Season", 1:NREPS)
colnames(COTSMat) = c("PIXEL_ID", "Year", "Season", 1:NREPS)
for (i in 1:NREPS){
load(sprintf("Sample_%s.Rdata", i))
CoralMat[,i+3] = Results[,"CoralCover"]
COTSMat[,i+3] = Results[,"COTSA"]
}
# browser()
# CC.df = as.data.frame(CoralMat) %>%
#   tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4))
# CC.Pixel = as.data.frame(CoralMat) %>%
#   tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4)) %>%
#   dplyr::group_by(PIXEL_ID, Year) %>%
#   dplyr::summarise(Avg.CC = mean(CoralCover, na.rm = T),
#             Serr.CC = sd(CoralCover, na.rm = T)/sqrt(n()),
#             Med.CC = median(CoralCover, na.rm = T),
#             Min.CC = quantile(CoralCover, probs = 0.05, na.rm = T),
#             Max.CC = quantile(CoralCover, probs = 0.95, na.rm = T),
#             Q25.CC = quantile(CoralCover, probs = 0.25, na.rm = T),
#             Q75.CC = quantile(CoralCover, probs = 0.75, na.rm = T))
CC.Reef = cbind("REEF_NAME" = Results$REEF_NAME, as.data.frame(CoralMat)) %>%
tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4)) %>%
dplyr::group_by(REEF_NAME, Year) %>%
dplyr::summarise(Avg.CC = mean(CoralCover, na.rm = T),
Serr.CC = sd(CoralCover, na.rm = T)/sqrt(n()),
Med.CC = median(CoralCover, na.rm = T),
Min.CC = quantile(CoralCover, probs = 0.05, na.rm = T),
Max.CC = quantile(CoralCover, probs = 0.95, na.rm = T),
Q25.CC = quantile(CoralCover, probs = 0.25, na.rm = T),
Q75.CC = quantile(CoralCover, probs = 0.75, na.rm = T))
CC.Cluster = cbind("REEF_NAME" = Results$REEF_NAME, as.data.frame(CoralMat)) %>%
tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4)) %>%
dplyr::left_join(dplyr::select(data.grid, PIXEL_ID, bent.clust), by="PIXEL_ID") %>%
dplyr::group_by(bent.clust, Year) %>%
dplyr::summarise(Avg.CC = mean(CoralCover, na.rm = T),
Serr.CC = sd(CoralCover, na.rm = T)/sqrt(n()),
Med.CC = median(CoralCover, na.rm = T),
Min.CC = quantile(CoralCover, probs = 0.05, na.rm = T),
Max.CC = quantile(CoralCover, probs = 0.95, na.rm = T),
Q25.CC = quantile(CoralCover, probs = 0.25, na.rm = T),
Q75.CC = quantile(CoralCover, probs = 0.75, na.rm = T))
CC.GBR = cbind("REEF_NAME" = Results$REEF_NAME,as.data.frame(CoralMat)) %>%
tidyr::gather(key = "Simulation", value = "CoralCover", 5:(NREPS+4)) %>%
dplyr::group_by(Year) %>%
dplyr::summarise(Avg.CC = mean(CoralCover, na.rm = T),
Serr.CC = sd(CoralCover, na.rm = T)/sqrt(n()),
Med.CC = median(CoralCover, na.rm = T),
Min.CC = quantile(CoralCover, probs = 0.05, na.rm = T),
Max.CC = quantile(CoralCover, probs = 0.95, na.rm = T),
Q25.CC = quantile(CoralCover, probs = 0.25, na.rm = T),
Q75.CC = quantile(CoralCover, probs = 0.75, na.rm = T))
# COTS.Pixel = as.data.frame(COTSMat) %>%
#   tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
#   dplyr::group_by(PIXEL_ID, Year) %>%
#   dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
#             Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
#             Med.COTS = median(COTS, na.rm = T),
#             Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
#             Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
#             Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
#             Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
COTS.Reef = cbind("REEF_NAME" = Results$REEF_NAME,as.data.frame(COTSMat)) %>%
tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
dplyr::group_by(REEF_NAME, Year) %>%
dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
Med.COTS = median(COTS, na.rm = T),
Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
COTS.Cluster = cbind("REEF_NAME" = Results$REEF_NAME,as.data.frame(COTSMat)) %>%
tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
dplyr::left_join(dplyr::select(data.grid, PIXEL_ID, bent.clust), by="PIXEL_ID") %>%
dplyr::group_by(bent.clust, Year) %>%
dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
Med.COTS = median(COTS, na.rm = T),
Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
COTS.GBR = cbind("REEF_NAME" = Results$REEF_NAME,as.data.frame(COTSMat)) %>%
tidyr::gather(key = "Simulation", value = "COTS", 5:(NREPS+4)) %>%
dplyr::group_by(Year) %>%
dplyr::summarise(Avg.COTS = mean(COTS, na.rm = T),
Serr.COTS = sd(COTS, na.rm = T)/sqrt(n()),
Med.COTS = median(COTS, na.rm = T),
Min.COTS = quantile(COTS, probs = 0.05, na.rm = T),
Max.COTS = quantile(COTS, probs = 0.95, na.rm = T),
Q25.COTS = quantile(COTS, probs = 0.25, na.rm = T),
Q75.COTS = quantile(COTS, probs = 0.75, na.rm = T))
Reef = dplyr::inner_join(CC.Reef, COTS.Reef, by=c("REEF_NAME", "Year"))
Cluster = dplyr::inner_join(CC.Cluster, COTS.Cluster, by=c("bent.clust", "Year"))
GBR = dplyr::inner_join(CC.GBR, COTS.GBR, by=c("Year"))
# Compute Statisctics against manta
return(list(Reef, Cluster, GBR))
}
DataHarvest.TEST = HarvestData(RESULTS_DIRECTORY)
